---
title: "Dashboard: NYC Restaurant Inspections"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    source: embed
---

```{r setup, include=FALSE}
library(tidyverse)
library(p8105.datasets)
library(plotly)
library(lubridate)

data("rest_inspec")
```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

Look at change in number of violations per month for each boro, and how they have changed over time.

```{r}
rest_inspec %>% 
  mutate(inspection_month = format(inspection_date, "%Y-%m")) %>% 
  filter(inspection_date > as.Date("2000-01-01"),
         boro != "Missing") %>% 
  select(boro, inspection_month) %>%
  group_by(boro, inspection_month) %>% 
  summarize(n_obs = n()) %>% 
  plot_ly(x = ~inspection_month, y = ~n_obs) %>% 
  add_lines(color = ~boro, colors = "viridis")
  
  
   #Just a note in case this is helpful later: mutate(text_label = str_c("Price: $", price, "\nRating: ", rating)) %>% 
```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}
rest_inspec %>% 
  mutate(year = year(inspection_date),
         month = month(inspection_date),
         year_month = make_date(year, month)) %>% 
  filter(inspection_date > as.Date("2000-01-01")) %>% 
  group_by(year, month) %>% 
  mutate(total_monthly_viol = n()) %>% 
  filter(violation_code == "02G" | violation_code == "02B") %>% 
  group_by(year_month, violation_code) %>% 
  summarize(viol_per_type = n(),
            total_monthly_viol = mean(total_monthly_viol)) %>% # keep total violations in the month and violations per violation code
  mutate(percent_viol = (viol_per_type/total_monthly_viol)*100) %>% 
  plot_ly(x = ~year_month, y = ~percent_viol, color = ~violation_code) %>% 
  add_lines(color = ~violation_code)
  
  
rest_inspec %>% 
  mutate(year = year(inspection_date),
         month = month(inspection_date),
         year_month = make_date(year, month)) %>% 
  filter(inspection_date > as.Date("2000-01-01"),
         violation_code == "02G" | violation_code == "02B") 
  select(year, violation_code) %>%
  group_by(violation_code, inspection_month) %>% 
  summarize(n_obs = n()) %>% 
  plot_ly(x = ~inspection_month, y = ~n_obs) %>% 
  add_lines(color = ~violation_code, colors = "viridis")
```

### Chart C

Let's look at the zipcodes with the most violations in Manhattan, and see how many violations they have in the dataset.

Ok, this is kind of boring, but it's a thing you can do...


NOTE: should probably make below into a histogram, might wanna do that vvvv

```{r}
rest_inspec %>% 
  filter(boro == "MANHATTAN") %>% 
  count(zipcode) %>%
  mutate(zipcode = as.factor(zipcode),
         zipcode = fct_reorder(zipcode, -n)) %>% 
  filter(min_rank(desc(n)) < 11) %>% 
  plot_ly(
    x = ~zipcode, y = ~n, 
    type = "bar")
```

